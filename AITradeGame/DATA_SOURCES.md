# 行情数据源多源集成功能

## 功能概述

本次更新为AITradeGame添加了多数据源支持，允许用户自定义行情数据的来源和优先级。系统会按照设置的优先级顺序尝试各个数据源，第一个成功的数据源将被使用。

## 支持的数据源

1. **Odaily星球日报** (推荐)
   - 可直接获取50+币种数据
   - 无需代理即可访问
   - 数据稳定可靠

2. **币界网 (528btc.com)**
   - 国内访问速度快
   - 无需代理
   - 数据更新及时

3. **币安API (Binance)**
   - 支持6种主流币种
   - 需要稳定的网络连接
   - 数据最为权威

4. **CoinGecko API**
   - 全球知名数据提供商
   - 支持大量币种
   - 作为最终备用方案

## 使用方法

### 1. 在Web界面配置

1. 点击页面右上角的"设置"按钮
2. 在"行情数据源优先级"部分选择您想要使用的数据源
3. 系统会按照从上到下的顺序尝试各个数据源
4. 点击"保存设置"完成配置

### 2. 默认配置

如果不进行任何配置，系统将使用以下默认优先级：
```
Odaily > 528btc > Binance > CoinGecko
```

### 3. 推荐配置

- **快速稳定**：勾选 Odaily + 528btc
- **数据权威**：勾选 Binance + CoinGecko
- **全面覆盖**：勾选全部数据源

## 技术实现

### 后端改动

1. **odaily_fetcher.py** - 新增Odaily数据获取模块
2. **market_data.py** - 增强多数据源支持
3. **database.py** - 添加数据源配置字段
4. **app.py** - 支持动态数据源切换

### 前端改动

1. **index.html** - 添加数据源选择界面
2. **app.js** - 实现数据源配置的读取和保存
3. **style.css** - 美化数据源选择器样式

### 数据库改动

settings表新增字段：
```sql
data_source_priority TEXT DEFAULT 'odaily,528btc,binance,coingecko'
```

## 测试

### 测试Odaily数据获取

```bash
cd AITradeGame
python3 odaily_fetcher.py
```

### 测试多数据源集成

```bash
cd AITradeGame
python3 test_data_sources.py
```

### 初始化数据库

```bash
cd AITradeGame
python3 init_db.py
```

## 故障排除

### 数据获取失败

如果所有数据源都失败，系统会返回模拟数据以确保页面正常显示。可以通过以下方式排查：

1. 检查网络连接
2. 尝试切换其他数据源
3. 查看控制台日志

### 数据源切换不生效

保存设置后，系统会自动刷新以应用新的数据源配置。如果没有生效：

1. 手动刷新页面
2. 检查浏览器控制台是否有错误
3. 查看服务器日志

## 优势

1. **容错性强** - 多数据源互为备份，单点故障不影响系统运行
2. **灵活配置** - 用户可根据网络环境和需求自由选择
3. **性能优化** - 数据缓存机制减少重复请求
4. **易于扩展** - 架构设计支持轻松添加新的数据源

## 未来规划

- [ ] 支持更多数据源（如币安、火币等交易所）
- [ ] 数据源健康度监控
- [ ] 自动切换故障数据源
- [ ] 数据质量评分系统

## 更新日志

**v1.1.0** - 2025-11-02
- ✨ 新增Odaily星球日报数据源
- ✨ 新增多数据源优先级配置
- 🎨 优化设置界面UI
- 🐛 修复数据获取失败时的错误处理
- 📝 添加测试脚本和文档
